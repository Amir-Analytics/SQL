
##Creating PLayer Stat Table

CREATE TABLE Player_stats
(
 Player_ID    int NOT NULL,
 Player_name  varchar(30) NOT NULL,
 Games        int NOT NULL,
 Minutes_played int NOT NULL,
 Goals        int NOT NULL,
 xG           decimal(6,4) NOT NULL,
 Assist       int NOT NULL,
 xA           decimal(6,4) NOT NULL,
 Shots        int NOT NULL,
 Key__passes  int NOT NULL,
 Yellow_cards int NOT NULL,
 Red_cards    int NOT NULL,
 Player_position   varchar(10) NOT NULL,
 Team_title   varchar(30) NOT NULL,
 NPG          int NOT NULL,
 NPxG         decimal(6,4) NOT NULL,
 xGchain      decimal(6,4) NOT NULL,
 xGbuildup    decimal(6,4) NOT NULL,
 CONSTRAINT PK_1 PRIMARY KEY ( Player_ID )
);

##Tranforming data and prep for analysis

SELECT
player_name as "Name",
games as "Games",
minutes_played as "Minutes Played",
goals as "Goals",
xg as "Expected Goals",
assist as "Assists",
xa as "Expected Assists",
shots as "Shots",
key__passes as "Key Passes",
team_title as "Team",
npg as "Non Penalty Goals",
npxg as "Non Penalty Expected Goals",
goals - npg as "Penalty Goals",

CASE WHEN minutes_played > 0 THEN round(((xg/minutes_played)*90),2) ELSE NULL END AS "Expected Goals Pr 90 min",
CASE WHEN minutes_played > 0 THEN round(((xa/minutes_played)*90),2) ELSE NULL END AS "Expected Assists Pr 90 min",
CASE WHEN minutes_played > 0 THEN round(((xa/minutes_played)*90),2) + round(((xg/minutes_played)*90),2) ELSE NULL END AS "Expected Goal Contribution Pr 90 min"

FROM public.master_player_stats
ORDER BY Goals DESC







